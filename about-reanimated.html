<html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="description" content=""/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="About Reanimated"/><meta name="twitter:description" content=""/><meta property="og:type" content="website"/><meta property="og:title" content="About Reanimated"/><meta property="og:description" content=""/><title>About Reanimated</title><link type="text/css" rel="stylesheet" href="app.css"/></head><body><div id='root'><div class="Layout_lugqar2"><aside class="sidebar_s9nrg4n"><input type="checkbox" class="menuButton_mzfqg8l" id="slide-sidebar" role="button"/><label class="menuIcon_m1mups47" for="slide-sidebar">☰</label><div class="menu_mdzibsv"><input type="search" value="" placeholder="Filter…" class="searchbar_s1nn5lbd"/><nav class="navigation_nlggdah"><a class="link_l5q2p2e" href="index.html">React Native Reanimated</a><a class="link_l5q2p2e active_al210no" href="about-reanimated.html">About Reanimated</a><a class="link_l5q2p2e" href="getting-started.html">Getting Started</a><a class="link_l5q2p2e" href="transitions.html">Transitions</a><a class="link_l5q2p2e" href="value.html">Value</a><a class="link_l5q2p2e" href="clock-and-the-algorithm.html">Clock and the algorithm</a><a class="link_l5q2p2e" href="block.html">Block</a><a class="link_l5q2p2e" href="views--props--etc.html">Views, props, etc</a><a class="link_l5q2p2e" href="animated-code.html">Animated.Code</a><a class="link_l5q2p2e" href="event-handling-with-reanimated-nodes.html">Event handling with reanimated nodes</a><div><div class="row_r1ol5l8s"><a class="link_l5q2p2e" href="">Base Nodes</a><button class="buttonIcon_b1e7pn53 expandedIcon_e12mn27x" style="opacity:0"><svg width="16px" height="16px" viewBox="0 0 16 16"><polygon stroke="none" stroke-width="1" fill-rule="evenodd" fill="currentColor" points="8 4 2 10 3.4 11.4 8 6.8 12.6 11.4 14 10"></polygon></svg></button></div><div class="groupItems_g19yxlm8 groupItemsVisible_g16acsvo"><a class="link_l5q2p2e" href="abs.html">abs</a><a class="link_l5q2p2e" href="acc.html">acc</a><a class="link_l5q2p2e" href="acos.html">acos</a><a class="link_l5q2p2e" href="add.html">add</a><a class="link_l5q2p2e" href="and.html">and</a><a class="link_l5q2p2e" href="asin.html">asin</a><a class="link_l5q2p2e" href="atan.html">atan</a><a class="link_l5q2p2e" href="block.html">block</a><a class="link_l5q2p2e" href="call.html">call</a><a class="link_l5q2p2e" href="ceil.html">ceil</a><a class="link_l5q2p2e" href="clock-running.html">clockRunning</a><a class="link_l5q2p2e" href="color.html">color</a><a class="link_l5q2p2e" href="concat.html">concat</a><a class="link_l5q2p2e" href="cond.html">cond</a><a class="link_l5q2p2e" href="cos.html">cos</a><a class="link_l5q2p2e" href="debug.html">debug</a><a class="link_l5q2p2e" href="defined.html">defined</a><a class="link_l5q2p2e" href="diff.html">diff</a><a class="link_l5q2p2e" href="diff-clamp.html">diffClamp</a><a class="link_l5q2p2e" href="divide.html">divide</a><a class="link_l5q2p2e" href="eq.html">eq</a><a class="link_l5q2p2e" href="event.html">event</a><a class="link_l5q2p2e" href="exp.html">exp</a><a class="link_l5q2p2e" href="floor.html">floor</a><a class="link_l5q2p2e" href="greater-or-eq.html">greaterOrEq</a><a class="link_l5q2p2e" href="greater-than.html">greaterThan</a><a class="link_l5q2p2e" href="interpolate.html">interpolate</a><a class="link_l5q2p2e" href="interpolate-colors.html">interpolateColors</a><a class="link_l5q2p2e" href="less-or-eq.html">lessOrEq</a><a class="link_l5q2p2e" href="less-than.html">lessThan</a><a class="link_l5q2p2e" href="log.html">log</a><a class="link_l5q2p2e" href="max.html">max</a><a class="link_l5q2p2e" href="min.html">min</a><a class="link_l5q2p2e" href="modulo.html">modulo</a><a class="link_l5q2p2e" href="multiply.html">multiply</a><a class="link_l5q2p2e" href="neq.html">neq</a><a class="link_l5q2p2e" href="not.html">not</a><a class="link_l5q2p2e" href="on-change.html">onChange</a><a class="link_l5q2p2e" href="or.html">or</a><a class="link_l5q2p2e" href="pow.html">pow</a><a class="link_l5q2p2e" href="proc.html">proc</a><a class="link_l5q2p2e" href="round.html">round</a><a class="link_l5q2p2e" href="set.html">set</a><a class="link_l5q2p2e" href="sin.html">sin</a><a class="link_l5q2p2e" href="sqrt.html">sqrt</a><a class="link_l5q2p2e" href="start-clock.html">startClock</a><a class="link_l5q2p2e" href="stop-clock.html">stopClock</a><a class="link_l5q2p2e" href="sub.html">sub</a><a class="link_l5q2p2e" href="tan.html">tan</a></div></div><div><div class="row_r1ol5l8s"><a class="link_l5q2p2e" href="">Animations</a><button class="buttonIcon_b1e7pn53 expandedIcon_e12mn27x" style="opacity:0"><svg width="16px" height="16px" viewBox="0 0 16 16"><polygon stroke="none" stroke-width="1" fill-rule="evenodd" fill="currentColor" points="8 4 2 10 3.4 11.4 8 6.8 12.6 11.4 14 10"></polygon></svg></button></div><div class="groupItems_g19yxlm8 groupItemsVisible_g16acsvo"><a class="link_l5q2p2e" href="decay.html">decay</a><a class="link_l5q2p2e" href="spring.html">spring</a><a class="link_l5q2p2e" href="spring-utils.html">springUtils</a><a class="link_l5q2p2e" href="timing.html">timing</a></div></div><a class="link_l5q2p2e" href="declarative-animation-api.html">Declarative Animation API</a><a class="link_l5q2p2e" href="examples.html">Examples</a></nav></div></aside><main class="Container_c119hgic"><div class="Inner_ir6lat6"><div><h1 id="motivation">
          <a class="anchor" href="#motivation">
            <svg width="16" height="16">
              <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
            </svg>
          </a>
        Motivation</h1>
<hr />
<p><code>Animated</code> library has several limitations that become troubling when it comes to gesture based interactions.
This project was initially created to resolve the issue of pan interaction when the object can be dragged along the screen and when released it should snap to some place on the screen.
The problem was that despite using <code>Animated.event</code> and mapping gesture state to the position of the box, and making this whole interaction run on UI thread with <code>useNativeDriver</code> flag, we still had to call back into JS at the end of the gesture for us to start "snap" animation.
This is because <code>Animated.spring({}).start()</code> cannot be used in a "declarative" manner, because when it gets executed it has a "side effect" of starting a process (an animation) that updates the value for some time.
Adding "side effect" nodes into the current Animated implementation turned out to be a pretty difficult task as the execution model of the Animated API runs all the dependent nodes of each frame for the views that need to update.
We don't want to run "side effects" more often than necessary as it would, for example, result in the animation starting multiple times.</p>
<p>Another inspiration to redesigning the internals of <code>Animated</code> was Krzysztof's work on porting "Animated Tracking" functionality to the native driver.
Apparently, even though the native driver is out for quite a while, it still does not support all the things non-native <code>Animated</code> lib can do.
Obviously, it is far more difficult to build three versions of each feature (JS, Android and iOS) instead of one, and the same applies for fixing bugs.
One of the goals of <code>react-native-reanimated</code> was to provide a more generic building block for the API that would allow for building more complex features only in JS and make the native codebase as minimal as possible.
Taking "diffClamp" node as an example, it is currently implemented in three different places in <code>Animated</code> core and even though it is pretty useful it actually only has one use case (collapsible scrollview header).</p>
<p>On a similar topic, there's React Native's PR <a href="https://github.com/facebook/react-native/pull/18029">#18029</a> and even though it provides a legitimate use case, maintainers are hesitant about merging it. The <code>Animated</code> API shouldn't block people from building things like this and the goal of <code>react-native-reanimated</code> is to provide lower level access that would allow for implementing that and many more features with no necessary changes to the core of the library.</p>
<p>You can watch Krzysztof Magiera's <a href="https://www.youtube.com/watch?v=kdq4z2708VM">React Europe talk</a> where he explains the motivation.</p>
<p>The goals:</p>
<ul>
<li>More generic primitive node types leading to more code reuse for the library internals therefore making it easier to add new features and fix bugs.</li>
<li>The new set of base nodes can be used to implement <code>Animated</code> compatible API including:<ul>
<li>Complex nodes such as “diffClamp”.</li>
<li>Interactions such as animated value tracking or animation staggering.</li>
</ul>
</li>
<li>Conditional evaluation &amp; nodes with side effects (<code>set</code>, <code>startClock</code>, <code>stopClock</code>).</li>
<li>No more “useNativeDriver” – all animations runs on the UI thread by default</li>
</ul>
<h1 id="reanimated-overview">
          <a class="anchor" href="#reanimated-overview">
            <svg width="16" height="16">
              <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
            </svg>
          </a>
        Reanimated overview</h1>
<p>We aim to bring this project to be fully compatible with <code>Animated</code> API. We believe that the set of base nodes we have selected should make this possible to be done only by writing JS code and does not require significant changes in the native codebases. Here is a list of things that haven't yet been ported from the original version of <code>Animated</code> library.
All the functionality that missing elements provide in <code>Animated</code> can already be achieved with <code>react-native-reanimated</code> although a different methodology for implementing those may be required (e.g. check <a href="declarative-animation-api.html">"Declarative Animation API" section</a> to see how the implementation may differ).</p>
<ul>
<li> using value offsets</li>
<li> value tracking (can be achieved in different way, <code>react-native-reanimated</code> also allows for tracking all the animation parameters not only destination params)</li>
<li> animation staggering</li>
<li> animation delays</li>
</ul>
<h1 id="at-most-once-evaluation-the-algorithm">
          <a class="anchor" href="#at-most-once-evaluation-the-algorithm-">
            <svg width="16" height="16">
              <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
            </svg>
          </a>
        At most once evaluation (the algorithm)</h1>
<p>Unlike the original <code>Animated</code> library where each node could have been evaluated many times within a single frame, <code>react-native-reanimated</code> restricts each node to be evaluated at most once in a frame.
This restriction is required for nodes that have side-effects to be used (e.g. <a href="set.html"><code>set</code></a> or <a href="start-clock.html"><code>startClock</code></a>).
When node is evaluated (e.g. in case of an <a href="add.html"><code>add</code></a> node we want to get a sum of the input nodes) its value is cached. If within the next frame there are other nodes that want to use the output of that node instead of evaluating we return cached value.
This notion also helps with performance as we can try to evaluate as few nodes as expected.
The current algorithm for making decisions of which nodes to evaluate works as follows:</p>
<ol>
<li>For each frame we first analyze the generated events (e.g. touch stream). It is possible that events may update some animated values.</li>
<li>Then we update values that correspond to <a href="clock-and-the-algorithm.html">clock</a> nodes that are "running".</li>
<li>We traverse the node's tree starting from the nodes that have been updated in the current cycle and we look for final nodes that are connected to views.</li>
<li>If we found nodes connected to view properties we evaluate them. This can recursively trigger an evaluation for their input nodes etc.</li>
<li>After everything is done we check if some "running" clocks exists. If so we enqueue a callback to be evaluated with the next frame and start over from pt 1. Otherwise we do nothing.</li>
</ol>
<h1 id="100-declarative-gesture-interactions">
          <a class="anchor" href="#100-declarative-gesture-interactions">
            <svg width="16" height="16">
              <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
            </svg>
          </a>
        100% declarative gesture interactions</h1>
<p><code>react-native-reanimated</code> works best with the <a href="https://kmagiera.github.io/react-native-gesture-handler">Gesture Handler</a> 
library. Currently all the examples are made using that library, including the ultimate 
<a href="https://github.com/software-mansion/react-native-reanimated/blob/master/Example/src/imageViewer">ImagePreview app</a>.</p>
</div></div></main></div></div>
    <script>
      window.__INITIAL_PATH__ = 'about-reanimated';
    </script>
  <script src="app.bundle.js"></script></body></html>